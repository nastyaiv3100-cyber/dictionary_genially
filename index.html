<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ö–∞—Ä—Ç–æ—á–µ–∫ v5.4 (Scroll Fix)</title>
<style>
    body { font-family: 'Segoe UI', sans-serif; background: #fff; padding: 15px; color: #333; margin: 0; height: 100vh; box-sizing: border-box; overflow: hidden; }
    
    /* –ú–∞–∫–µ—Ç —Ç–µ–ø–µ—Ä—å –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É –æ–∫–Ω–∞ Genially */
    .main-layout { display: flex; gap: 20px; height: 100%; }
    
    /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å (—É–∑–∫–∞—è) */
    .settings-panel { 
        background: #f9f9fa; padding: 15px; border-radius: 12px; 
        border: 1px solid #eee; width: 300px; flex-shrink: 0; 
        display: flex; flex-direction: column; overflow-y: auto;
    }

    /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (—Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è) */
    .preview-panel { 
        flex-grow: 1; display: flex; flex-direction: column; gap: 10px; height: 100%; 
        min-width: 0; /* –í–∞–∂–Ω–æ –¥–ª—è flexbox */
    }

    h2 { margin: 0 0 10px 0; color: #2c3e50; font-size: 1.1rem; border-bottom: 2px solid #e0e0e0; padding-bottom: 5px; }
    label { display: block; margin-bottom: 4px; font-weight: 600; font-size: 0.85rem; color: #555; }
    
    input[type="color"] { width: 100%; height: 35px; border: 1px solid #ccc; border-radius: 6px; cursor: pointer; padding: 0; background: none; }
    input[type="range"] { width: 100%; margin: 8px 0; }
    
    /* –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π */
    .word-list { flex-grow: 1; min-height: 150px; overflow-y: auto; border: 1px solid #ddd; border-radius: 6px; padding: 8px; background: #fff; margin-bottom: 10px; }
    .check-item { display: flex; align-items: center; padding: 4px 0; border-bottom: 1px solid #f5f5f5; }
    .check-item label { font-size: 0.85rem; cursor: pointer; width: 100%; margin: 0; display: flex; align-items: center; }
    .check-item input { margin-right: 8px; }

    button.generate-btn {
        background: #2196F3; color: white; border: none; padding: 12px; 
        font-size: 14px; border-radius: 8px; cursor: pointer; width: 100%; 
        font-weight: bold; margin-top: auto; /* –ü—Ä–∏–∂–∞—Ç—å –∫ –Ω–∏–∑—É */
    }
    button.generate-btn:hover { background: #1976D2; }

    /* –û–ö–ù–û –ü–†–ï–î–ü–†–û–°–ú–û–¢–†–ê –° –ü–†–û–ö–†–£–¢–ö–û–ô */
    .preview-box {
        background: #fff; border-radius: 12px; 
        flex-grow: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ */
        border: 2px dashed #ccc;
        position: relative;
        overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–π —Å–∫—Ä–æ–ª–ª */
    }
    
    /* Iframe –≤–Ω—É—Ç—Ä–∏ –±—É–¥–µ—Ç —Å–∫—Ä–æ–ª–ª–∏—Ç—å—Å—è —Å–∞–º */
    iframe.preview-iframe {
        width: 100%; height: 100%; border: none;
    }
    
    .code-area { height: 80px; flex-shrink: 0; background: #fff; padding: 10px; border-radius: 12px; border: 1px solid #eee; }
    textarea { width: 100%; height: 100%; padding: 5px; border-radius: 6px; border: 1px solid #ccc; font-family: monospace; font-size: 11px; resize: none; box-sizing: border-box; }
</style>
</head>
<body>

<div class="main-layout">
    <div class="settings-panel">
        <h2>üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∏ v5.4</h2>
        
        <label>–ú–∞—Å—à—Ç–∞–±: <span id="scaleVal" style="color:#2196F3">1.0</span></label>
        <input type="range" id="scaleInput" min="0.3" max="1.5" step="0.1" value="1.0" oninput="updatePreview()">
        
        <div style="display:flex; gap:10px;">
            <div style="flex:1"><label>–§–æ–Ω:</label><input type="color" id="cardColor" value="#FF9800" oninput="updatePreview()"></div>
            <div style="flex:1"><label>–¢–µ–∫—Å—Ç:</label><input type="color" id="textColor" value="#FFFFFF" oninput="updatePreview()"></div>
        </div>
        <br>

        <label>–°–ª–æ–≤–∞—Ä—å (<a href="#" onclick="toggleAll(true); return false;">–í—Å–µ</a> / <a href="#" onclick="toggleAll(false); return false;">–°–±—Ä–æ—Å</a>)</label>
        <div class="word-list" id="wordListContainer"></div>

        <button class="generate-btn" onclick="generateCode()">üì¶ –ü–û–õ–£–ß–ò–¢–¨ –ö–û–î</button>
    </div>

    <div class="preview-panel">
        <label>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ, –µ—Å–ª–∏ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç):</label>
        <div class="preview-box" id="previewArea"></div>
        
        <div class="code-area">
            <label style="margin-top:0;">–ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ (Insert -> Others):</label>
            <textarea id="resultCode" readonly onclick="this.select()"></textarea>
        </div>
    </div>
</div>

<script>
    const dictionaryDB = {
        "–±–∞–∫–ª—É—à–∏ –±–∏—Ç—å": "–ë–µ–∑–¥–µ–ª—å–Ω–∏—á–∞—Ç—å, –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –ø—É—Å—Ç—è–∫–∞–º–∏.",
        "–±–µ–∑ –≥–æ–¥—É –Ω–µ–¥–µ–ª—è": "–°–æ–≤—Å–µ–º –Ω–µ–¥–∞–≤–Ω–æ, –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è.",
        "–±–µ–ª–∞—è –≤–æ—Ä–æ–Ω–∞": "–ß–µ–ª–æ–≤–µ–∫, —Ä–µ–∑–∫–æ –≤—ã–¥–µ–ª—è—é—â–∏–π—Å—è –∏–∑ –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã.",
        "–±–ª–æ—Ö—É –ø–æ–¥–∫–æ–≤–∞—Ç—å": "–ò—Å–∫—É—Å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∞–º—É—é –∑–∞–º—ã—Å–ª–æ–≤–∞—Ç—É—é —Ä–∞–±–æ—Ç—É.",
        "–≤ –µ–∂–æ–≤—ã—Ö —Ä—É–∫–∞–≤–∏—Ü–∞—Ö": "–û—á–µ–Ω—å —Å—Ç—Ä–æ–≥–æ, —Å—É—Ä–æ–≤–æ.",
        "–≤ —á–∞—Å –ø–æ —á–∞–π–Ω–æ–π –ª–æ–∂–∫–µ": "–û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ.",
        "–≤–µ—à–∞—Ç—å –≥–æ–ª–æ–≤—É": "–£–Ω—ã–≤–∞—Ç—å.",
        "–≤–∏–ª–∞–º–∏ –ø–æ –≤–æ–¥–µ –ø–∏—Å–∞–Ω–æ": "–ò—Å—Ö–æ–¥ –Ω–µ —è—Å–µ–Ω, –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ –∫–∞–∫ –±—É–¥–µ—Ç.",
        "–≤–∏—Ç–∞—Ç—å –≤ –æ–±–ª–∞–∫–∞—Ö": "–§–∞–Ω—Ç–∞–∑–∏—Ä–æ–≤–∞—Ç—å, –º–µ—á—Ç–∞—Ç—å.",
        "–≤–æ–¥–∏—Ç—å –∑–∞ –Ω–æ—Å": "–û–±–º–∞–Ω—ã–≤–∞—Ç—å, –≤–≤–æ–¥–∏—Ç—å –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ.",
        "–≤–æ–¥–æ–π –Ω–µ —Ä–∞–∑–ª–∏—Ç—å": "–û –∫—Ä–µ–ø–∫–æ–π –¥—Ä—É–∂–±–µ.",
        "–≤–æ–ª–æ—Å—ã –¥—ã–±–æ–º": "–û—á–µ–Ω—å —Å—Ç—Ä–∞—à–Ω–æ.",
        "–≤—ã–≤–µ—Å—Ç–∏ –Ω–∞ —á–∏—Å—Ç—É—é –≤–æ–¥—É": "–†–∞–∑–æ–±–ª–∞—á–∏—Ç—å, —É–ª–∏—á–∏—Ç—å –≤–æ –ª–∂–∏.",
        "–¥–µ–ª–∞—Ç—å –∏–∑ –º—É—Ö–∏ —Å–ª–æ–Ω–∞": "–°–∏–ª—å–Ω–æ –ø—Ä–µ—É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å.",
        "–¥–µ—Ä–∂–∞—Ç—å —è–∑—ã–∫ –∑–∞ –∑—É–±–∞–º–∏": "–ú–æ–ª—á–∞—Ç—å.",
        "–¥—É—à–∞ –≤ –ø—è—Ç–∫–∏": "–°–∏–ª—å–Ω—ã–π –∏—Å–ø—É–≥.",
        "–∑–∞—Ä—É–±–∏—Ç—å –Ω–∞ –Ω–æ—Å—É": "–ö—Ä–µ–ø–∫–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞.",
        "–∫–∞–∫ –≤ –≤–æ–¥—É –≥–ª—è–¥–µ–ª": "–ü—Ä–µ–¥–≤–∏–¥–µ–ª —Å–æ–±—ã—Ç–∏—è.",
        "–∫–∞–∫ –¥–≤–µ –∫–∞–ø–ª–∏ –≤–æ–¥—ã": "–û—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏.",
        "–∫–∞–∫ —Ä—ã–±–∞ –≤ –≤–æ–¥–µ": "–ß—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è —É–≤–µ—Ä–µ–Ω–Ω–æ.",
        "–∫–∞–∫ —Å –≥—É—Å—è –≤–æ–¥–∞": "–í—Å—ë –Ω–∏–ø–æ—á–µ–º, –±–µ–∑—Ä–∞–∑–ª–∏—á–Ω–æ.",
        "–∫–ª–µ–≤–∞—Ç—å –Ω–æ—Å–æ–º": "–î—Ä–µ–º–∞—Ç—å.",
        "–∫–æ—Ç –Ω–∞–ø–ª–∞–∫–∞–ª": "–û—á–µ–Ω—å –º–∞–ª–æ.",
        "–∫—Ä–æ–∫–æ–¥–∏–ª–æ–≤—ã —Å–ª–µ–∑—ã": "–ü—Ä–∏—Ç–≤–æ—Ä–Ω–æ–µ —Å–æ–∂–∞–ª–µ–Ω–∏–µ.",
        "–º–µ–¥–≤–µ–¥—å –Ω–∞ —É—Ö–æ –Ω–∞—Å—Ç—É–ø–∏–ª": "–ù–µ—Ç –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ —Å–ª—É—Ö–∞.",
        "–º–æ—Ä–æ—á–∏—Ç—å –≥–æ–ª–æ–≤—É": "–°–±–∏–≤–∞—Ç—å —Å —Ç–æ–ª–∫—É.",
        "–Ω–∞ —Å–µ–¥—å–º–æ–º –Ω–µ–±–µ": "–í –ø–æ–ª–Ω–æ–º –≤–æ—Å—Ç–æ—Ä–≥–µ.",
        "–Ω–µ –≤ —Å–≤–æ–µ–π —Ç–∞—Ä–µ–ª–∫–µ": "–ß—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –Ω–µ—É—é—Ç–Ω–æ.",
        "–Ω–∏ –ø—É—Ö–∞ –Ω–∏ –ø–µ—Ä–∞": "–ü–æ–∂–µ–ª–∞–Ω–∏–µ —É–¥–∞—á–∏.",
        "–æ–±–≤–µ—Å—Ç–∏ –≤–æ–∫—Ä—É–≥ –ø–∞–ª—å—Ü–∞": "–õ–æ–≤–∫–æ –æ–±–º–∞–Ω—É—Ç—å.",
        "–ø–æ—Å–ª–µ –¥–æ–∂–¥–∏—á–∫–∞ –≤ —á–µ—Ç–≤–µ—Ä–≥": "–ù–∏–∫–æ–≥–¥–∞.",
        "—Å–µ–º—å –ø—è—Ç–Ω–∏—Ü –Ω–∞ –Ω–µ–¥–µ–ª–µ": "–û —á–µ–ª–æ–≤–µ–∫–µ, —á–∞—Å—Ç–æ –º–µ–Ω—è—é—â–µ–º —Ä–µ—à–µ–Ω–∏—è.",
        "—Å–µ—Å—Ç—å –≤ –∫–∞–ª–æ—à—É": "–û–∫–∞–∑–∞—Ç—å—Å—è –≤ —Å–º–µ—à–Ω–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏, –Ω–µ—É–¥–∞—á–∞.",
        "—Å–∏–¥–µ—Ç—å —Å–ª–æ–∂–∞ —Ä—É–∫–∏": "–ë–µ–∑–¥–µ–ª—å–Ω–∏—á–∞—Ç—å.",
        "—Å–∫–≤–æ–∑—å –∑–µ–º–ª—é –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è": "–°–∏–ª—å–Ω–æ —Å—Ç—ã–¥–∏—Ç—å—Å—è.",
        "—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∫–≤–æ–∑—å –ø–∞–ª—å—Ü—ã": "–ù–µ –∑–∞–º–µ—á–∞—Ç—å –ø–ª–æ—Ö–æ–≥–æ.",
        "—Å–æ–±–∞–∫—É —Å—ä–µ–ª": "–ò–º–µ—Ç—å –±–æ–ª—å—à–æ–π –æ–ø—ã—Ç.",
        "—Å—á–∏—Ç–∞—Ç—å –≤–æ—Ä–æ–Ω": "–û—Ç–≤–ª–µ–∫–∞—Ç—å—Å—è.",
        "—Ç–∏—à–µ –≤–æ–¥—ã –Ω–∏–∂–µ —Ç—Ä–∞–≤—ã": "–ë—ã—Ç—å –Ω–µ–∑–∞–º–µ—Ç–Ω—ã–º.",
        "—Ç—è–Ω—É—Ç—å –∫–æ—Ç–∞ –∑–∞ —Ö–≤–æ—Å—Ç": "–ú–µ–¥–ª–∏—Ç—å.",
        "—É–º—ã–≤–∞—Ç—å —Ä—É–∫–∏": "–°–Ω–∏–º–∞—Ç—å —Å —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.",
        "—Ö–æ—Ç—å –≥–ª–∞–∑ –≤—ã–∫–æ–ª–∏": "–û—á–µ–Ω—å —Ç–µ–º–Ω–æ.",
        "—è–∑—ã–∫ –ø—Ä–æ–≥–ª–æ—Ç–∏—Ç—å": "–ó–∞–º–æ–ª—á–∞—Ç—å."
    };

    function initList() {
        const container = document.getElementById('wordListContainer');
        Object.keys(dictionaryDB).sort().forEach((key, i) => {
            const div = document.createElement('div');
            div.className = 'check-item';
            div.innerHTML = `<label><input type="checkbox" value="${key}" ${i<6?'checked':''} onchange="updatePreview()"> ${key}</label>`;
            container.appendChild(div);
        });
        updatePreview();
    }

    function toggleAll(state) {
        document.querySelectorAll('#wordListContainer input').forEach(cb => cb.checked = state);
        updatePreview();
    }

    function getInnerHtml(settings, items) {
        return `
        <!DOCTYPE html>
        <html>
        <head>
        <style>
            /* Body has auto scroll */
            body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background-color: transparent; width: 100vw; overflow-x: hidden; overflow-y: auto; }
            
            .scaler {
                /* Force width to break lines */
                width: calc(100vw / ${settings.scale} - 40px); 
                transform: scale(${settings.scale});
                transform-origin: 0 0;
                display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;
                padding: 10px; box-sizing: border-box;
                /* Add padding bottom to avoid cut-off at very bottom */
                padding-bottom: 100px;
            }
            .flip-card { background-color: transparent; width: 180px; height: 120px; perspective: 1000px; cursor: pointer; margin-bottom: 10px; }
            .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; box-shadow: 0 4px 8px rgba(0,0,0,0.15); border-radius: 12px; }
            .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
            .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 12px; display: flex; align-items: center; justify-content: center; padding: 10px; box-sizing: border-box; }
            .flip-card-front { background-color: ${settings.cardColor}; color: ${settings.textColor}; }
            .flip-card-front p { font-size: 1.1em; font-weight: bold; margin: 0; text-transform: uppercase; }
            .flip-card-back { background-color: white; color: #333; transform: rotateY(180deg); border: 3px solid ${settings.cardColor}; }
            .flip-card-back p { font-size: 0.9em; margin: 0; line-height: 1.3; }
        </style>
        </head>
        <body>
            <div class="scaler">
                ${items.map(item => `
                    <div class="flip-card" onclick="this.classList.toggle('flipped')">
                        <div class="flip-card-inner">
                            <div class="flip-card-front"><p>${item.phrase}</p></div>
